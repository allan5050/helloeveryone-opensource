#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "Running pre-commit checks..."

# 1. SECRET SCANNING (Critical - blocks commits with secrets)
echo "ğŸ”’ Scanning for secrets and API keys..."
npm run security:secrets
if [ $? -ne 0 ]; then
  echo "âŒ Secret scan failed! Commit blocked."
  exit 1
fi

# 2. Run lint-staged for staged files
npm run lint-staged

# 3. Run quick security scan (edge cases, patterns)
echo "ğŸ›¡ï¸  Running quick security scan..."
npm run security:scan:quick
if [ $? -ne 0 ]; then
  echo "âš ï¸  Security scan found issues! Review findings before committing."
  exit 1
fi

# 4. Run security tests (authentication, edge cases, business logic)
echo "ğŸ§ª Running security tests..."
npm run test:security
if [ $? -ne 0 ]; then
  echo "âš ï¸  Security tests failed! Review findings before committing."
  exit 1
fi

# 5. Type check (commented out by default - enable when TS errors are fixed)
# echo "Running TypeScript type check..."
# npm run type-check

echo "âœ… All pre-commit checks passed!"